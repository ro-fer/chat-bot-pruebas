<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitio en ConstrucciÃ³n</title>
    <link rel="stylesheet" href="../static/styles.css" />
</head>
<body>
    <!-- CONTENIDO EN CONSTRUCCIÃ“N -->
    <div class="construction-container">
        <div class="construction-icon">ðŸš§</div>
        <h1>Â¡Sitio en ConstrucciÃ³n!</h1>
        <p class="construction-text">Estamos trabajando duro para crear algo increÃ­ble para ti.</p>
        <p class="construction-text">Mientras tanto, puedes chatear con nuestra asistente virtual:</p>
        
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
        
        <div class="contact-info">
            <p><strong>PrÃ³ximamente disponible</strong></p>
            <p>Mientras tanto, usa el chat de la esquina â†“</p>
        </div>
    </div>

    <!-- WIDGET DE CHAT SARASA -->
    <div class="tina-chat-widget">
        <div class="tina-chat-window" id="tinaChatWindow">
            <div class="tina-chat-header">
                <button class="tina-close-btn" onclick="toggleTinaChat()">Ã—</button>
                <h3>Â¡Hola, soy Sarasa! ðŸ‘‹</h3>
                <p>Tu asistente virtual de Puntos Digitales</p>
            </div>
            
            <div class="tina-chat-messages" id="tinaMessages">
                <div class="tina-message tina-bot-message">
                    <strong>Â¡Hola! ðŸ‘‹</strong><br>
                    Veo que el sitio estÃ¡ en construcciÃ³n, pero yo estoy aquÃ­ para ayudarte.<br><br>
                    
                    <strong>ðŸ’¡ Puedes preguntar sobre:</strong><br>
                    <div class="tina-quick-options">
                        <button onclick="quickOption('Stock')">ðŸ“¦ Stock</button>
                        <button onclick="quickOption('Proyectos')">ðŸ“‹ Proyectos</button>
                        <button onclick="quickOption('Soporte tÃ©cnico')">ðŸ”§ Soporte</button>
                        <button onclick="quickOption('CartelerÃ­a')">ðŸŽ¨ CartelerÃ­a</button>
                        <button onclick="quickOption('InstalaciÃ³n')">âš¡ InstalaciÃ³n</button>
                        <button onclick="quickOption('Reequipamiento')">ðŸ”„ Reequipamiento</button>
                    </div>
                    <br>
                    Â¿En quÃ© puedo asistirte con Puntos Digitales?
                </div>
            </div>
            
            <div class="tina-typing" id="tinaTyping">
                Sarasa estÃ¡ escribiendo...
            </div>
            
            <div class="tina-chat-input">
                <input type="text" id="tinaInput" placeholder="Escribe tu pregunta..." autocomplete="off">
                <button onclick="sendTinaMessage()">Enviar</button>
            </div>
        </div>
        
        <button class="tina-chat-button" onclick="toggleTinaChat()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" fill="white"/>
            </svg>
        </button>
    </div>

    <script>
        let isTinaOpen = false;

        function toggleTinaChat() {
            const chatWindow = document.getElementById('tinaChatWindow');
            isTinaOpen = !isTinaOpen;
            
            if (isTinaOpen) {
                chatWindow.classList.add('active');
                document.getElementById('tinaInput').focus();
            } else {
                chatWindow.classList.remove('active');
            }
        }

        function addTinaMessage(message, isUser = false, showQuickOptions = false) {
            const messagesDiv = document.getElementById('tinaMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `tina-message ${isUser ? 'tina-user-message' : 'tina-bot-message'}`;
            
            if (showQuickOptions) {
                messageDiv.innerHTML = message + `
                    <div class="tina-quick-options">
                        <button onclick="quickOption('Stock')">ðŸ“¦ Stock</button>
                        <button onclick="quickOption('Proyectos')">ðŸ“‹ Proyectos</button>
                        <button onclick="quickOption('Soporte tÃ©cnico')">ðŸ”§ Soporte</button>
                        <button onclick="quickOption('CartelerÃ­a')">ðŸŽ¨ CartelerÃ­a</button>
                        <button onclick="quickOption('InstalaciÃ³n')">âš¡ InstalaciÃ³n</button>
                        <button onclick="quickOption('Reequipamiento')">ðŸ”„ Reequipamiento</button>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = message;
            }
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTinaTyping() {
            document.getElementById('tinaTyping').style.display = 'block';
        }

        function hideTinaTyping() {
            document.getElementById('tinaTyping').style.display = 'none';
        }

        // FunciÃ³n para opciones rÃ¡pidas
        function quickOption(option) {
            document.getElementById('tinaInput').value = option;
            sendTinaMessage();
        }

        async function sendTinaMessage() {
            const input = document.getElementById('tinaInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addTinaMessage(message, true);
            input.value = '';
            
            showTinaTyping();
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        prompt: message,
                        source: 'widget'
                    })
                });
                
                const data = await response.json();
                hideTinaTyping();
                
                if (data.success) {
                    // Mostrar botones despuÃ©s de cada respuesta del bot
                    addTinaMessage(data.response, false, true);
                } else {
                    addTinaMessage('âŒ Lo siento, hubo un error. Por favor, intenta nuevamente.');
                }
            } catch (error) {
                hideTinaTyping();
                addTinaMessage('âŒ Error de conexiÃ³n. Verifica tu internet.');
            }
        }

        document.getElementById('tinaInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendTinaMessage();
            }
        });

        // Auto-abrir despuÃ©s de 3 segundos
        setTimeout(() => {
            if (!isTinaOpen) {
                toggleTinaChat();
            }
        }, 3000);
    </script>
</body>
</html>